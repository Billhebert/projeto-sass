<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemplo - Integra√ß√£o com ML</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .code-block {
      background: #f8f8f8;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 20px 0;
      overflow-x: auto;
      border-radius: 5px;
    }

    .code-block code {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
    }

    .section {
      margin: 30px 0;
    }

    .section h2 {
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    .status-box {
      background: #f0f1fa;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
    }

    .status-box.success {
      background: #d4edda;
      border-left-color: #28a745;
      color: #155724;
    }

    .status-box.error {
      background: #f8d7da;
      border-left-color: #dc3545;
      color: #721c24;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      font-weight: 600;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .demo-section {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 5px;
      margin: 15px 0;
    }

    .output {
      background: #333;
      color: #00ff00;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85em;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    ul {
      margin-left: 20px;
      line-height: 1.8;
    }

    li {
      color: #666;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Exemplo: Integra√ß√£o com Mercado Livre</h1>
    <p>Demonstra√ß√£o de como usar o gerenciador de m√∫ltiplas contas Mercado Livre.</p>

    <!-- Se√ß√£o de Setup -->
    <div class="section">
      <h2>1. Setup Inicial</h2>
      <p>Para inicializar o gerenciador, voc√™ pode usar:</p>

      <div class="code-block">
        <code>const integration = new MLFrontendIntegration({
  apiBaseUrl: 'http://localhost:3000/api',
  syncInterval: 5 * 60 * 1000, // 5 minutos
});

await integration.init();</code>
      </div>

      <div id="initStatus" class="status-box"></div>

      <div class="demo-section">
        <button id="btnInit">Inicializar</button>
        <div class="output" id="initOutput">Aguardando...</div>
      </div>
    </div>

    <!-- Se√ß√£o de Gerenciamento -->
    <div class="section">
      <h2>2. Gerenciar Contas</h2>

      <h3>Obter Contas</h3>
      <div class="demo-section">
        <button id="btnGetAccounts">Obter Todas as Contas</button>
        <div class="output" id="accountsOutput">Nenhuma conta carregada</div>
      </div>

      <h3>Adicionar Conta (Manual)</h3>
      <div class="demo-section">
        <p>Este √© um exemplo simulado. Em produ√ß√£o, use OAuth.</p>
        <button id="btnAddAccount">Adicionar Conta Exemplo</button>
        <div class="output" id="addAccountOutput"></div>
      </div>

      <h3>Sincronizar</h3>
      <div class="demo-section">
        <button id="btnSyncAll">Sincronizar Todas as Contas</button>
        <button id="btnClearLogs">Limpar Logs</button>
        <div class="output" id="syncOutput"></div>
      </div>
    </div>

    <!-- Se√ß√£o de Eventos -->
    <div class="section">
      <h2>3. Escutar Eventos</h2>
      <p>O sistema dispara eventos quando a√ß√µes ocorrem:</p>

      <ul>
        <li><strong>mlAccountAdded</strong>: Quando uma conta √© adicionada</li>
        <li><strong>mlAccountRemoved</strong>: Quando uma conta √© removida</li>
        <li><strong>mlSyncStarted</strong>: Quando sincroniza√ß√£o inicia</li>
        <li><strong>mlSyncCompleted</strong>: Quando sincroniza√ß√£o termina</li>
        <li><strong>mlSyncError</strong>: Quando erro ocorre</li>
      </ul>

      <div class="code-block">
        <code>window.addEventListener('mlSyncCompleted', (e) => {
  console.log('Sincroniza√ß√£o conclu√≠da:', e.detail);
});</code>
      </div>

      <div class="demo-section">
        <h3>Monitor de Eventos</h3>
        <div class="output" id="eventOutput">Aguardando eventos...</div>
      </div>
    </div>

    <!-- Se√ß√£o de Logs -->
    <div class="section">
      <h2>4. Logs de Sincroniza√ß√£o</h2>
      <p>Todos os eventos s√£o registrados para auditoria:</p>

      <div class="demo-section">
        <button id="btnGetLogs">Obter Logs</button>
        <div class="output" id="logsOutput">Nenhum log carregado</div>
      </div>
    </div>

    <!-- Se√ß√£o de API -->
    <div class="section">
      <h2>5. API Dispon√≠vel</h2>

      <h3>M√©todos</h3>
      <ul>
        <li><code>init()</code> - Inicializar integra√ß√£o</li>
        <li><code>getAccounts()</code> - Obter todas as contas</li>
        <li><code>getAccount(id)</code> - Obter conta espec√≠fica</li>
        <li><code>addAccount(data)</code> - Adicionar nova conta</li>
        <li><code>removeAccount(id)</code> - Remover conta</li>
        <li><code>sync(id)</code> - Sincronizar conta</li>
        <li><code>syncAll()</code> - Sincronizar todas</li>
        <li><code>toggleSync(id)</code> - Pausar/retomar</li>
        <li><code>getLogs(id?)</code> - Obter logs</li>
        <li><code>destroy()</code> - Destruir inst√¢ncia</li>
      </ul>
    </div>

    <!-- Se√ß√£o de Uso em Produ√ß√£o -->
    <div class="section">
      <h2>6. Uso em Produ√ß√£o</h2>

      <div class="code-block">
        <code>// No seu HTML
&lt;script src="/src/scripts/mercado-livre/accounts-manager.js"&gt;&lt;/script&gt;
&lt;script src="/src/scripts/mercado-livre/oauth-handler.js"&gt;&lt;/script&gt;
&lt;script src="/src/scripts/mercado-livre/frontend-integration.js"&gt;&lt;/script&gt;

// No seu JavaScript
const integration = await MLFrontendIntegration.init({
  apiBaseUrl: 'https://seudominio.com/api',
  syncInterval: 10 * 60 * 1000, // 10 minutos
});

// Usar
const accounts = integration.getAccounts();
await integration.syncAll();</code>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/src/scripts/mercado-livre/accounts-manager.js"></script>
  <script src="/src/scripts/mercado-livre/oauth-handler.js"></script>
  <script src="/src/scripts/mercado-livre/frontend-integration.js"></script>

  <script>
    let integration;
    let logIndex = 0;

    /**
     * Log output
     */
    function log(message, outputId = 'initOutput') {
      const output = document.getElementById(outputId);
      if (output) {
        const timestamp = new Date().toLocaleTimeString('pt-BR');
        output.textContent += `[${timestamp}] ${message}\n`;
        output.scrollTop = output.scrollHeight;
      }
    }

    /**
     * Inicializar
     */
    document.getElementById('btnInit').addEventListener('click', async () => {
      try {
        log('Inicializando...', 'initOutput');
        
        integration = new MLFrontendIntegration({
          apiBaseUrl: 'http://localhost:3000/api',
          syncInterval: 5 * 60 * 1000,
        });

        await integration.init();

        log('‚úÖ Inicializado com sucesso!', 'initOutput');
        document.getElementById('initStatus').textContent = '‚úÖ Integra√ß√£o inicializada';
        document.getElementById('initStatus').classList.add('success');

        // Configurar listeners
        setupEventListeners();
      } catch (error) {
        log(`‚ùå Erro: ${error.message}`, 'initOutput');
        document.getElementById('initStatus').textContent = `‚ùå Erro: ${error.message}`;
        document.getElementById('initStatus').classList.add('error');
      }
    });

    /**
     * Obter contas
     */
    document.getElementById('btnGetAccounts').addEventListener('click', () => {
      if (!integration) {
        log('Inicialize primeiro!', 'accountsOutput');
        return;
      }

      const accounts = integration.getAccounts();
      const output = document.getElementById('accountsOutput');
      output.textContent = JSON.stringify(accounts, null, 2);
    });

    /**
     * Adicionar conta
     */
    document.getElementById('btnAddAccount').addEventListener('click', async () => {
      if (!integration) {
        log('Inicialize primeiro!', 'addAccountOutput');
        return;
      }

      try {
        log('Adicionando conta exemplo...', 'addAccountOutput');

        const account = await integration.addAccount({
          userId: 'user-' + Date.now(),
          nickname: 'conta-exemplo-' + Math.random().toString(36).substr(2, 9),
          email: 'exemplo@teste.com',
          accessToken: 'APP_USR-' + Math.random().toString(36).substr(2, 15),
          refreshToken: 'APP_REF-' + Math.random().toString(36).substr(2, 15),
          tokenExpiresAt: new Date(Date.now() + 6 * 60 * 60 * 1000).toISOString(),
        });

        log(`‚úÖ Conta adicionada: ${account.nickname}`, 'addAccountOutput');
        log(JSON.stringify(account, null, 2), 'addAccountOutput');
      } catch (error) {
        log(`‚ùå Erro: ${error.message}`, 'addAccountOutput');
      }
    });

    /**
     * Sincronizar todas
     */
    document.getElementById('btnSyncAll').addEventListener('click', async () => {
      if (!integration) {
        log('Inicialize primeiro!', 'syncOutput');
        return;
      }

      try {
        log('Sincronizando todas as contas...', 'syncOutput');
        const results = await integration.syncAll();
        log(`‚úÖ Sincroniza√ß√£o conclu√≠da!\nResultados: ${JSON.stringify(results, null, 2)}`, 'syncOutput');
      } catch (error) {
        log(`‚ùå Erro: ${error.message}`, 'syncOutput');
      }
    });

    /**
     * Obter logs
     */
    document.getElementById('btnGetLogs').addEventListener('click', () => {
      if (!integration) {
        log('Inicialize primeiro!', 'logsOutput');
        return;
      }

      const logs = integration.getLogs();
      const output = document.getElementById('logsOutput');
      output.textContent = JSON.stringify(logs, null, 2);
    });

    /**
     * Limpar logs
     */
    document.getElementById('btnClearLogs').addEventListener('click', () => {
      document.getElementById('syncOutput').textContent = '';
      log('Logs sincronizados', 'syncOutput');
    });

    /**
     * Configurar listeners de eventos
     */
    function setupEventListeners() {
      const eventOutput = document.getElementById('eventOutput');
      eventOutput.textContent = '';

      window.addEventListener('mlAccountAdded', (e) => {
        log(`üì± Conta Adicionada: ${JSON.stringify(e.detail.account)}`, 'eventOutput');
      });

      window.addEventListener('mlAccountRemoved', (e) => {
        log(`üì± Conta Removida: ${JSON.stringify(e.detail.account)}`, 'eventOutput');
      });

      window.addEventListener('mlSyncStarted', (e) => {
        log(`üîÑ Sincroniza√ß√£o Iniciada: ${e.detail.accountId}`, 'eventOutput');
      });

      window.addEventListener('mlSyncCompleted', (e) => {
        log(`‚úÖ Sincroniza√ß√£o Conclu√≠da: ${e.detail.accountId}`, 'eventOutput');
      });

      window.addEventListener('mlSyncError', (e) => {
        log(`‚ùå Erro de Sincroniza√ß√£o: ${e.detail.message}`, 'eventOutput');
      });

      log('‚úÖ Listeners configurados', 'eventOutput');
    }

    // Inicializar automaticamente
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('btnInit').click();
    });
  </script>
</body>
</html>
