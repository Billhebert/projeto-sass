<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relat√≥rios - Dashboard</title>
  <link rel="stylesheet" href="../../dist/styles/products.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="brand">üìä Dashboard</div>
    <div class="user-section">
      <div class="avatar" id="userAvatar">--</div>
      <div style="flex: 1; padding: 0 12px;">
        <div style="font-size: 12px; font-weight: 600;" id="userName">Usu√°rio</div>
        <div style="font-size: 11px; color: #999; margin-top: 2px;" id="userEmail">user@example.com</div>
      </div>
      <button onclick="logout()">Sair</button>
    </div>
  </div>

  <!-- Navigation Menu -->
  <nav class="navbar">
    <div class="nav-container">
      <ul class="nav-menu">
        <!-- Dashboard -->
        <li class="nav-item">
          <a href="../dashboard/index.html" class="nav-link">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>

        <!-- Produtos (Dropdown) -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" onclick="toggleDropdown(event)">
            <span class="nav-icon">üì¶</span>
            <span class="nav-text">Produtos</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <ul class="dropdown-menu">
            <li><a href="../products/index.html" class="dropdown-link">Meus Produtos (SKUs)</a></li>
            <li><a href="../categories/index.html" class="dropdown-link">Categorias</a></li>
            <li><a href="../stock/index.html" class="dropdown-link">Estoque</a></li>
          </ul>
        </li>

        <!-- Vendas -->
        <li class="nav-item">
          <a href="../sales/index.html" class="nav-link">
            <span class="nav-icon">üí∞</span>
            <span class="nav-text">Vendas</span>
          </a>
        </li>

        <!-- Relat√≥rios -->
        <li class="nav-item">
          <a href="../reports/index.html" class="nav-link active">
            <span class="nav-icon">üìà</span>
            <span class="nav-text">Relat√≥rios</span>
          </a>
        </li>

        <!-- Configura√ß√µes -->
        <li class="nav-item">
          <a href="../settings/index.html" class="nav-link">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-text">Configura√ß√µes</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="../dashboard/index.html">Dashboard</a>
    <span class="breadcrumb-sep">/</span>
    <span class="breadcrumb-current">Relat√≥rios</span>
  </div>

  <!-- Main Content -->
  <div class="container">
    <!-- Reports Navigation Tabs -->
    <div style="display: flex; gap: 12px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap;">
      <button class="report-tab active" onclick="switchReport('sales')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid #5D4DB3; color: #5D4DB3; cursor: pointer; font-weight: 600; font-size: 14px;">
        üí∞ Vendas
      </button>
      <button class="report-tab" onclick="switchReport('products')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; cursor: pointer; font-weight: 600; font-size: 14px;">
        üì¶ Produtos
      </button>
      <button class="report-tab" onclick="switchReport('inventory')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; cursor: pointer; font-weight: 600; font-size: 14px;">
        üìä Estoque
      </button>
      <button class="report-tab" onclick="switchReport('financial')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; cursor: pointer; font-weight: 600; font-size: 14px;">
        üíµ Financeiro
      </button>
    </div>

    <!-- Sales Report -->
    <div id="sales-report" class="report-section" style="display: block;">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">üí∞ Relat√≥rio de Vendas</h2>
          <p class="form-subtitle">An√°lise completa de vendas por per√≠odo, marketplace e produtos</p>
        </div>

        <!-- Filter Section -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 6px;">
          <div>
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px;">Data Inicial</label>
            <input type="date" id="salesStartDate" class="form-input" style="width: 100%; padding: 8px;">
          </div>
          <div>
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px;">Data Final</label>
            <input type="date" id="salesEndDate" class="form-input" style="width: 100%; padding: 8px;">
          </div>
          <div>
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px;">Marketplace</label>
            <select id="salesMarketplace" class="form-input" style="width: 100%; padding: 8px;">
              <option value="">Todos</option>
              <option value="mercado-livre">Mercado Livre</option>
              <option value="b2b-brasil">B2B Brasil</option>
              <option value="amazon">Amazon</option>
              <option value="shopee">Shopee</option>
              <option value="loja-propria">Loja Pr√≥pria</option>
            </select>
          </div>
          <div style="display: flex; align-items: flex-end; gap: 8px;">
            <button onclick="reportModule.generateSalesReport()" style="flex: 1; padding: 8px; background: #5D4DB3; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
              üîÑ Gerar Relat√≥rio
            </button>
            <button onclick="reportModule.exportPDF('sales')" style="flex: 1; padding: 8px; background: #2F9BD6; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
              üì• PDF
            </button>
          </div>
        </div>

        <!-- Sales Summary -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
          <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Total de Vendas</div>
            <div style="font-size: 20px; font-weight: bold;" id="salesCount">0</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Quantidade Total</div>
            <div style="font-size: 20px; font-weight: bold;" id="totalQuantity">0</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Faturamento Total</div>
            <div style="font-size: 20px; font-weight: bold;" id="totalRevenue">R$ 0,00</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 6px; color: #333;">
            <div style="font-size: 11px; opacity: 0.8;">Ticket M√©dio</div>
            <div style="font-size: 20px; font-weight: bold;" id="avgTicket">R$ 0,00</div>
          </div>
        </div>

        <!-- Sales by Marketplace Chart -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div style="padding: 15px; background: white; border-radius: 6px; border: 1px solid #e0e0e0;">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 15px;">Vendas por Marketplace</div>
            <canvas id="salesByMarketplaceChart" style="max-height: 250px;"></canvas>
          </div>
          <div style="padding: 15px; background: white; border-radius: 6px; border: 1px solid #e0e0e0;">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 15px;">M√©todo de Pagamento</div>
            <canvas id="salesByPaymentChart" style="max-height: 250px;"></canvas>
          </div>
        </div>

        <!-- Sales Table -->
        <div style="overflow-x: auto; border-radius: 6px; border: 1px solid #e0e0e0;">
          <table class="products-table" style="margin: 0;">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Qtd</th>
                <th>Pre√ßo Unit.</th>
                <th>Total</th>
                <th>Marketplace</th>
                <th>Pagamento</th>
                <th>Data</th>
              </tr>
            </thead>
            <tbody id="salesReportTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Products Report -->
    <div id="products-report" class="report-section" style="display: none;">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">üì¶ Relat√≥rio de Produtos</h2>
          <p class="form-subtitle">Invent√°rio e desempenho de produtos</p>
        </div>

        <!-- Product Summary -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
          <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Total de Produtos</div>
            <div style="font-size: 20px; font-weight: bold;" id="prodCount">0</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Categorias</div>
            <div style="font-size: 20px; font-weight: bold;" id="prodCategories">0</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 6px; color: #333;">
            <div style="font-size: 11px; opacity: 0.8;">Estoque Total</div>
            <div style="font-size: 20px; font-weight: bold;" id="totalStock">0</div>
          </div>
        </div>

        <!-- Products Table -->
        <div style="overflow-x: auto; border-radius: 6px; border: 1px solid #e0e0e0;">
          <table class="products-table" style="margin: 0;">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Estoque</th>
                <th>Status</th>
                <th>Data Cadastro</th>
              </tr>
            </thead>
            <tbody id="productsReportTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <button onclick="reportModule.exportCSV('products')" style="margin-top: 15px; padding: 10px 16px; background: #2F9BD6; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
          üì• Exportar CSV
        </button>
      </div>
    </div>

    <!-- Inventory Report -->
    <div id="inventory-report" class="report-section" style="display: none;">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">üìä Relat√≥rio de Estoque</h2>
          <p class="form-subtitle">An√°lise de movimenta√ß√µes e n√≠veis de estoque</p>
        </div>

        <!-- Filter -->
        <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px;">SKU (opcional)</label>
            <input type="text" id="inventorySKU" placeholder="Buscar por SKU..." class="form-input" style="padding: 8px;">
          </div>
          <div style="display: flex; align-items: flex-end; gap: 8px;">
            <button onclick="reportModule.generateInventoryReport()" style="padding: 8px 16px; background: #5D4DB3; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
              üîÑ Gerar
            </button>
            <button onclick="reportModule.exportCSV('inventory')" style="padding: 8px 16px; background: #2F9BD6; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
              üì• CSV
            </button>
          </div>
        </div>

        <!-- Stock Movements Table -->
        <div style="overflow-x: auto; border-radius: 6px; border: 1px solid #e0e0e0;">
          <table class="products-table" style="margin: 0;">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Tipo</th>
                <th>Quantidade</th>
                <th>Estoque Ant.</th>
                <th>Novo Estoque</th>
                <th>Data/Hora</th>
              </tr>
            </thead>
            <tbody id="inventoryReportTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Financial Report -->
    <div id="financial-report" class="report-section" style="display: none;">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">üíµ Relat√≥rio Financeiro</h2>
          <p class="form-subtitle">An√°lise financeira detalhada de vendas</p>
        </div>

        <!-- Financial Summary -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 20px;">
          <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Receita Total</div>
            <div style="font-size: 18px; font-weight: bold;" id="finTotalRevenue">R$ 0,00</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Desconto Total</div>
            <div style="font-size: 18px; font-weight: bold;" id="finTotalDiscount">R$ 0,00</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 6px; color: white;">
            <div style="font-size: 11px; opacity: 0.9;">Margem M√©dia</div>
            <div style="font-size: 18px; font-weight: bold;" id="finAvgMargin">0%</div>
          </div>
          <div style="padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 6px; color: #333;">
            <div style="font-size: 11px; opacity: 0.8;">Ticket M√©dio</div>
            <div style="font-size: 18px; font-weight: bold;" id="finAvgTicket">R$ 0,00</div>
          </div>
        </div>

        <!-- Financial Chart -->
        <div style="padding: 15px; background: white; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
          <div style="font-size: 13px; font-weight: 600; margin-bottom: 15px;">Receita por Dia (√∫ltimos 30 dias)</div>
          <canvas id="finRevenueChart" style="max-height: 300px;"></canvas>
        </div>

        <!-- Financial Table -->
        <div style="overflow-x: auto; border-radius: 6px; border: 1px solid #e0e0e0;">
          <table class="products-table" style="margin: 0;">
            <thead>
              <tr>
                <th>Data</th>
                <th>Qtd Vendas</th>
                <th>Receita</th>
                <th>Desconto</th>
                <th>L√≠quido</th>
                <th>Ticket M√©dio</th>
              </tr>
            </thead>
            <tbody id="financialReportTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <button onclick="reportModule.exportPDF('financial')" style="margin-top: 15px; padding: 10px 16px; background: #2F9BD6; color: white; border: none; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer;">
          üì• Exportar PDF
        </button>
      </div>
    </div>
  </div>

  <script src="../../src/scripts/auth.js"></script>
  <script src="../../src/scripts/reports.js"></script>
  <script>
    // Check authentication
    authService.requireAuth();
    
    // Load user info
    const user = authService.getUser();
    if (user) {
      document.getElementById('userName').textContent = user.name || 'Usu√°rio';
      document.getElementById('userEmail').textContent = user.email || '';
      
      const initials = (user.name || 'U')
        .split(' ')
        .slice(0, 2)
        .map(n => n[0])
        .join('')
        .toUpperCase();
      document.getElementById('userAvatar').textContent = initials;
    }

    // Toggle dropdown menu
    function toggleDropdown(e) {
      e.preventDefault();
      const dropdown = e.target.closest('.dropdown');
      dropdown.classList.toggle('active');
    }

    // Switch between report sections
    function switchReport(reportType) {
      // Hide all reports
      document.querySelectorAll('.report-section').forEach(section => {
        section.style.display = 'none';
      });
      document.querySelectorAll('.report-tab').forEach(btn => {
        btn.style.borderBottomColor = 'transparent';
        btn.style.color = '#666';
      });

      // Show selected report
      document.getElementById(reportType + '-report').style.display = 'block';
      event.target.style.borderBottomColor = '#5D4DB3';
      event.target.style.color = '#5D4DB3';

      // Generate report data
      if (reportType === 'sales') {
        reportModule.generateSalesReport();
      } else if (reportType === 'products') {
        reportModule.generateProductsReport();
      } else if (reportType === 'inventory') {
        reportModule.generateInventoryReport();
      } else if (reportType === 'financial') {
        reportModule.generateFinancialReport();
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      reportModule.init();
    });
  </script>
</body>
</html>
