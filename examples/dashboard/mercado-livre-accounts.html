<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciador de Contas - Projeto SASS</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 40px;
    }

    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    /* Card Estilo */
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .card-title {
      font-size: 1.3em;
      color: #333;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      width: 30px;
      height: 30px;
      background: #667eea;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9em;
    }

    /* Bot√£o Adicionar Conta */
    .btn-add-account {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 25px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      font-weight: 600;
    }

    .btn-add-account:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    /* Lista de Contas */
    .accounts-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .account-card {
      background: #f8f9fa;
      border-left: 5px solid #667eea;
      padding: 15px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .account-card:hover {
      background: #f0f1fa;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .account-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 12px;
    }

    .account-info h3 {
      color: #333;
      margin-bottom: 5px;
    }

    .account-info p {
      color: #666;
      font-size: 0.9em;
    }

    .account-status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .status-connected {
      background: #d4edda;
      color: #155724;
    }

    .status-syncing {
      background: #fff3cd;
      color: #856404;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
    }

    .account-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 12px 0;
    }

    .stat-item {
      background: white;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.3em;
      font-weight: 600;
      color: #667eea;
    }

    .stat-label {
      font-size: 0.8em;
      color: #999;
      text-transform: uppercase;
    }

    .account-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .btn-small {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-sync {
      background: #667eea;
      color: white;
    }

    .btn-sync:hover {
      background: #5568d3;
    }

    .btn-remove {
      background: #dc3545;
      color: white;
    }

    .btn-remove:hover {
      background: #c82333;
    }

    .btn-toggle {
      background: #17a2b8;
      color: white;
    }

    .btn-toggle:hover {
      background: #138496;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      font-size: 1.5em;
      color: #333;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: #999;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      color: #333;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.95em;
      font-family: inherit;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-primary {
      flex: 1;
      background: #667eea;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-secondary {
      flex: 1;
      background: #e9ecef;
      color: #333;
      border: none;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      background: #dee2e6;
    }

    /* Notifica√ß√µes */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 2000;
      animation: slideIn 0.3s ease;
      border-left: 5px solid;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .notification.success {
      border-left-color: #28a745;
      background: #f8f9fa;
    }

    .notification.error {
      border-left-color: #dc3545;
      background: #fff5f5;
    }

    .notification.info {
      border-left-color: #17a2b8;
      background: #f0f9ff;
    }

    /* Stats Dashboard */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      color: #999;
      font-size: 0.9em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .stat-card .number {
      font-size: 2.5em;
      color: #667eea;
      font-weight: 700;
    }

    /* Logs */
    .logs-container {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
    }

    .log-item {
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
      font-size: 0.9em;
    }

    .log-item:last-child {
      border-bottom: none;
    }

    .log-time {
      color: #999;
      font-size: 0.85em;
    }

    .log-message {
      color: #333;
      margin: 3px 0;
    }

    .log-info { color: #17a2b8; }
    .log-success { color: #28a745; }
    .log-error { color: #dc3545; }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(102, 126, 234, 0.3);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üéØ Gerenciador de Contas</h1>
      <p>Gerencie m√∫ltiplas contas do Mercado Livre com sincroniza√ß√£o autom√°tica</p>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Contas Conectadas</h3>
        <div class="number" id="totalAccounts">0</div>
      </div>
      <div class="stat-card">
        <h3>Total de Produtos</h3>
        <div class="number" id="totalProducts">0</div>
      </div>
      <div class="stat-card">
        <h3>Total de Pedidos</h3>
        <div class="number" id="totalOrders">0</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Adicionar Conta -->
      <div class="card">
        <div class="card-title">
          <div class="card-icon">‚ûï</div>
          Adicionar Nova Conta
        </div>
        <button class="btn-add-account" id="addAccountBtn">
          Conectar Conta Mercado Livre
        </button>
        <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
          Clique no bot√£o para iniciar o processo de autentica√ß√£o com o Mercado Livre. 
          Voc√™ ser√° redirecionado para fazer login em sua conta.
        </p>
      </div>

      <!-- Sincroniza√ß√£o -->
      <div class="card">
        <div class="card-title">
          <div class="card-icon">üîÑ</div>
          Sincroniza√ß√£o
        </div>
        <div style="margin-bottom: 15px;">
          <p style="color: #666; margin-bottom: 10px;">
            Status: <strong id="syncStatus">Aguardando...</strong>
          </p>
          <p style="color: #999; font-size: 0.9em;">
            √öltima sincroniza√ß√£o: <strong id="lastSyncTime">Nunca</strong>
          </p>
        </div>
        <button class="btn-add-account" id="syncAllBtn" style="background: #28a745;">
          üîÑ Sincronizar Todas as Contas
        </button>
        <div style="margin-top: 15px; padding: 10px; background: #f0f1fa; border-radius: 6px;">
          <p style="color: #666; font-size: 0.85em; margin-bottom: 5px;">
            ‚ÑπÔ∏è As contas sincronizam automaticamente a cada 5 minutos
          </p>
          <p style="color: #666; font-size: 0.85em;">
            Voc√™ pode clicar no bot√£o acima para sincronizar imediatamente
          </p>
        </div>
      </div>
    </div>

    <!-- Contas -->
    <div class="card">
      <div class="card-title">
        <div class="card-icon">üì±</div>
        Minhas Contas (<span id="accountCount">0</span>)
      </div>
      <div id="accountsList" class="accounts-list">
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <p>Nenhuma conta conectada</p>
          <p style="font-size: 0.9em; margin-top: 10px;">Clique em "Conectar Conta Mercado Livre" para adicionar uma</p>
        </div>
      </div>
    </div>

    <!-- Logs -->
    <div class="card" style="margin-top: 20px;">
      <div class="card-title">
        <div class="card-icon">üìã</div>
        Logs de Sincroniza√ß√£o
      </div>
      <div id="logsList" class="logs-container">
        <div style="text-align: center; color: #999;">
          <p>Nenhum log ainda</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Adicionar Conta -->
  <div class="modal" id="addAccountModal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Conectar Conta Mercado Livre</span>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>
      <form id="addAccountForm">
        <div class="form-group">
          <label>Selecione como conectar</label>
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button type="button" id="oauthBtn" class="btn-primary" style="flex: 1;">
              üîê OAuth (Recomendado)
            </button>
            <button type="button" id="manualBtn" class="btn-primary" style="flex: 1; background: #6c757d;">
              ‚öôÔ∏è Manual
            </button>
          </div>
        </div>

        <!-- OAuth Section -->
        <div id="oauthSection" style="display: none; margin-top: 20px;">
          <p style="color: #666; margin-bottom: 15px;">
            Voc√™ ser√° redirecionado para fazer login no Mercado Livre. 
            Depois, autorizar√° este aplicativo a acessar sua conta.
          </p>
          <button type="button" id="startOAuthBtn" class="btn-primary">
            Iniciar Autentica√ß√£o OAuth
          </button>
        </div>

        <!-- Manual Section -->
        <div id="manualSection" style="display: none;">
          <div class="form-group">
            <label>Nickname/Email</label>
            <input type="text" id="manualNickname" placeholder="seu-email@example.com" required>
          </div>
          <div class="form-group">
            <label>Token de Acesso</label>
            <textarea id="manualAccessToken" placeholder="Cole seu token de acesso aqui" required></textarea>
          </div>
          <div class="form-group">
            <label>Token de Refresh (opcional)</label>
            <textarea id="manualRefreshToken" placeholder="Cole seu token de refresh aqui"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Conectar</button>
            <button type="button" class="btn-secondary" id="cancelManual">Cancelar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="accounts-manager.js"></script>
  <script src="oauth-handler.js"></script>
  <script>
    // Inst√¢ncia do gerenciador
    let accountsManager;

    // Inicializar
    function init() {
      accountsManager = new MLAccountsManager({
        apiBaseUrl: 'http://localhost:3000/api',
        syncInterval: 5 * 60 * 1000, // 5 minutos
      });

      setupEventListeners();
      setupManagerListeners();
      updateUI();

      // Verificar se voltamos de OAuth
      checkOAuthCallback();
    }

    /**
     * Configurar listeners da UI
     */
    function setupEventListeners() {
      document.getElementById('addAccountBtn').addEventListener('click', showAddModal);
      document.getElementById('closeModal').addEventListener('click', closeModal);
      document.getElementById('syncAllBtn').addEventListener('click', syncAll);
      document.getElementById('oauthBtn').addEventListener('click', () => showOAuthSection());
      document.getElementById('manualBtn').addEventListener('click', () => showManualSection());
      document.getElementById('startOAuthBtn').addEventListener('click', startOAuth);
      document.getElementById('addAccountForm').addEventListener('submit', handleManualSubmit);
      document.getElementById('cancelManual').addEventListener('click', closeModal);

      // Fechar modal ao clicar fora
      document.getElementById('addAccountModal').addEventListener('click', (e) => {
        if (e.target.id === 'addAccountModal') {
          closeModal();
        }
      });
    }

    /**
     * Configurar listeners do gerenciador
     */
    function setupManagerListeners() {
      accountsManager.on('accountAdded', (account) => {
        showNotification(`Conta "${account.nickname}" adicionada com sucesso!`, 'success');
        updateUI();
      });

      accountsManager.on('accountRemoved', (account) => {
        showNotification(`Conta "${account.nickname}" removida`, 'info');
        updateUI();
      });

      accountsManager.on('syncStarted', ({ accountId }) => {
        updateUI();
      });

      accountsManager.on('syncCompleted', ({ accountId, data }) => {
        showNotification(`Sincroniza√ß√£o conclu√≠da para conta`, 'success');
        updateUI();
      });

      accountsManager.on('syncError', ({ accountId, message }) => {
        showNotification(`Erro ao sincronizar: ${message}`, 'error');
        updateUI();
      });
    }

    /**
     * Mostrar modal de adicionar conta
     */
    function showAddModal() {
      document.getElementById('addAccountModal').classList.add('active');
      document.getElementById('oauthSection').style.display = 'none';
      document.getElementById('manualSection').style.display = 'none';
    }

    /**
     * Fechar modal
     */
    function closeModal() {
      document.getElementById('addAccountModal').classList.remove('active');
      document.getElementById('addAccountForm').reset();
    }

    /**
     * Mostrar se√ß√£o OAuth
     */
    function showOAuthSection() {
      document.getElementById('oauthSection').style.display = 'block';
      document.getElementById('manualSection').style.display = 'none';
    }

    /**
     * Mostrar se√ß√£o Manual
     */
    function showManualSection() {
      document.getElementById('oauthSection').style.display = 'none';
      document.getElementById('manualSection').style.display = 'block';
    }

    /**
     * Iniciar OAuth
     */
    function startOAuth() {
      const oauthHandler = new MLOAuthHandler({
        clientId: 'YOUR_CLIENT_ID', // Ser√° configurado via backend
        redirectUri: `${window.location.origin}/examples/dashboard/mercado-livre-accounts.html`,
      });
      oauthHandler.startAuthentication();
    }

    /**
     * Verificar callback de OAuth
     */
    function checkOAuthCallback() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get('code');
      const state = params.get('state');

      if (code && state) {
        // Validar state
        const savedState = sessionStorage.getItem('oauth_state');
        if (state !== savedState) {
          showNotification('Erro de autentica√ß√£o: estado inv√°lido', 'error');
          return;
        }

        // Trocar c√≥digo por tokens
        exchangeCodeForTokens(code).then(account => {
          if (account) {
            accountsManager.addAccount(account);
            closeModal();
          }
        });
      }
    }

    /**
     * Trocar c√≥digo por tokens
     */
    async function exchangeCodeForTokens(code) {
      try {
        const response = await fetch('http://localhost:3000/api/auth/ml/exchange-token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code }),
        });

        if (!response.ok) {
          throw new Error('Falha ao trocar c√≥digo por tokens');
        }

        const data = await response.json();
        return {
          userId: data.userId,
          nickname: data.nickname,
          email: data.email,
          accessToken: data.accessToken,
          refreshToken: data.refreshToken,
          tokenExpiresAt: data.tokenExpiresAt,
        };
      } catch (error) {
        console.error('Erro ao trocar c√≥digo:', error);
        showNotification(`Erro: ${error.message}`, 'error');
        return null;
      }
    }

    /**
     * Lidar com envio manual do formul√°rio
     */
    async function handleManualSubmit(e) {
      e.preventDefault();

      const nickname = document.getElementById('manualNickname').value;
      const accessToken = document.getElementById('manualAccessToken').value;
      const refreshToken = document.getElementById('manualRefreshToken').value;

      try {
        const account = {
          nickname,
          accessToken,
          refreshToken: refreshToken || null,
          tokenExpiresAt: new Date(Date.now() + 6 * 60 * 60 * 1000).toISOString(),
        };

        await accountsManager.addAccount(account);
        closeModal();
      } catch (error) {
        showNotification(`Erro: ${error.message}`, 'error');
      }
    }

    /**
     * Sincronizar todas as contas
     */
    async function syncAll() {
      const btn = document.getElementById('syncAllBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Sincronizando...';

      try {
        const results = await accountsManager.syncAll();
        const successful = results.filter(r => r.success).length;
        showNotification(`${successful}/${results.length} contas sincronizadas`, 'success');
      } catch (error) {
        showNotification(`Erro ao sincronizar: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'üîÑ Sincronizar Todas as Contas';
        updateUI();
      }
    }

    /**
     * Atualizar UI
     */
    function updateUI() {
      const accounts = accountsManager.getAccounts();

      // Atualizar contadores
      document.getElementById('accountCount').textContent = accounts.length;
      document.getElementById('totalAccounts').textContent = accounts.length;

      const totalProducts = accounts.reduce((sum, acc) => sum + (acc.products || 0), 0);
      const totalOrders = accounts.reduce((sum, acc) => sum + (acc.orders || 0), 0);

      document.getElementById('totalProducts').textContent = totalProducts.toLocaleString('pt-BR');
      document.getElementById('totalOrders').textContent = totalOrders.toLocaleString('pt-BR');

      // Atualizar lista de contas
      const accountsList = document.getElementById('accountsList');
      if (accounts.length === 0) {
        accountsList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <p>Nenhuma conta conectada</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Clique em "Conectar Conta Mercado Livre" para adicionar uma</p>
          </div>
        `;
      } else {
        accountsList.innerHTML = accounts.map(account => `
          <div class="account-card">
            <div class="account-header">
              <div class="account-info">
                <h3>üì¶ ${escapeHtml(account.nickname)}</h3>
                <p>${escapeHtml(account.email)}</p>
              </div>
              <span class="account-status status-${account.status}">
                ${account.isSyncing ? '<span class="spinner"></span>' : getStatusLabel(account.status)}
              </span>
            </div>

            <div class="account-stats">
              <div class="stat-item">
                <div class="stat-value">${account.products || 0}</div>
                <div class="stat-label">Produtos</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${account.orders || 0}</div>
                <div class="stat-label">Pedidos</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${account.issues || 0}</div>
                <div class="stat-label">Problemas</div>
              </div>
            </div>

            <div style="font-size: 0.85em; color: #999;">
              ${account.lastSync ? `√öltima sincroniza√ß√£o: ${new Date(account.lastSync).toLocaleString('pt-BR')}` : 'Nunca sincronizado'}
            </div>

            <div class="account-actions">
              <button class="btn-small btn-sync" onclick="syncAccount('${account.id}')">
                Sincronizar
              </button>
              <button class="btn-small btn-toggle" onclick="toggleSync('${account.id}')">
                ${account.syncEnabled ? 'Pausar' : 'Retomar'}
              </button>
              <button class="btn-small btn-remove" onclick="removeAccount('${account.id}')">
                Remover
              </button>
            </div>
          </div>
        `).join('');
      }

      // Atualizar logs
      updateLogs();
      updateSyncStatus();
    }

    /**
     * Sincronizar conta individual
     */
    async function syncAccount(accountId) {
      try {
        await accountsManager.sync(accountId);
      } catch (error) {
        showNotification(`Erro ao sincronizar: ${error.message}`, 'error');
      }
    }

    /**
     * Ativar/desativar sincroniza√ß√£o
     */
    function toggleSync(accountId) {
      accountsManager.toggleSyncEnabled(accountId);
      updateUI();
    }

    /**
     * Remover conta
     */
    function removeAccount(accountId) {
      const account = accountsManager.getAccount(accountId);
      if (confirm(`Tem certeza que deseja remover a conta "${account.nickname}"?`)) {
        accountsManager.removeAccount(accountId);
        updateUI();
      }
    }

    /**
     * Atualizar logs
     */
    function updateLogs() {
      const logs = accountsManager.getLogs().reverse().slice(0, 20);
      const logsList = document.getElementById('logsList');

      if (logs.length === 0) {
        logsList.innerHTML = '<div style="text-align: center; color: #999;"><p>Nenhum log ainda</p></div>';
        return;
      }

      logsList.innerHTML = logs.map(log => `
        <div class="log-item">
          <div class="log-time">${new Date(log.timestamp).toLocaleTimeString('pt-BR')}</div>
          <div class="log-message log-${log.level}">${escapeHtml(log.message)}</div>
        </div>
      `).join('');
    }

    /**
     * Atualizar status de sincroniza√ß√£o
     */
    function updateSyncStatus() {
      const accounts = accountsManager.getAccounts();
      const syncing = accounts.some(acc => acc.isSyncing);
      const statusEl = document.getElementById('syncStatus');

      if (syncing) {
        statusEl.textContent = 'üîÑ Sincronizando...';
      } else {
        statusEl.textContent = '‚úÖ Pronto';
      }

      const lastSyncTimes = accounts
        .filter(acc => acc.lastSync)
        .map(acc => new Date(acc.lastSync).getTime());

      if (lastSyncTimes.length > 0) {
        const lastSync = new Date(Math.max(...lastSyncTimes));
        document.getElementById('lastSyncTime').textContent = lastSync.toLocaleString('pt-BR');
      }
    }

    /**
     * Obter label de status
     */
    function getStatusLabel(status) {
      const labels = {
        connected: 'üü¢ Conectado',
        syncing: 'üü° Sincronizando',
        error: 'üî¥ Erro',
        token_expired: '‚è∞ Token Expirado',
      };
      return labels[status] || '‚ùì Desconhecido';
    }

    /**
     * Mostrar notifica√ß√£o
     */
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    /**
     * Escapar HTML
     */
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Inicializar quando DOM estiver pronto
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
